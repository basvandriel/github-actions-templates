name: 'Kubectl Setup'
description: 'Set up kubectl with kubeconfig and verify connection'

inputs:
  kubeconfig:
    description: 'The kubeconfig content'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up kubectl
      uses: azure/setup-kubectl@v3
      with:
        version: 'latest'

    - name: Write kubeconfig
      run: echo "${{ inputs.kubeconfig }}" > kubeconfig
      shell: bash

    - name: Verify kubectl connection
      run: kubectl cluster-info
      shell: bash
      env:
        KUBECONFIG: kubeconfig

    - name: Upload kubeconfig
      uses: actions/upload-artifact@v4
      with:
        name: kubeconfig
        path: kubeconfig